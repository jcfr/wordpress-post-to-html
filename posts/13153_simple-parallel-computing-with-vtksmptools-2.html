<meta charset="utf-8">
<div class="entry-content">
 <p>
  <span style="font-size: 14px;">
   <span style="color: #000080;">
    <strong>
     Introduction
    </strong>
   </span>
  </span>
  <br/>
  The Visualization Toolkit (VTK) system has been in active development for over 20 years, and from the earliest days, the community has concerned itself with parallel computing. The class
  <span style="font-family: courier;">
   vtkMultiThreader
  </span>
  was introduced in 1997, mainly to support threaded, shared-memory data processing in the imaging pipeline. Scalable, distributed parallel computing has also been a major focus. Applications such as ParaView depend on these capabilities to execute on large leadership computing facilities. For example, ParaView/VTK has been successfully run using 256K processors in a coprocessing simulation with the Phasta turbulent flow analysis code on Mira, Argonne National Laboratory’s IBM Blue Gene/Q system [1]. Such data-parallel, distributed computing applications require a sophisticated execution model, and VTK has seen several incarnations of the pipeline architecture as a result.
 </p>
 <p>
  Similar development efforts continue to this day, with client-server models extending the reach of server-side parallel computing through systems such as VTK/ParaViewWeb [2]. In fact, with the advent of cloud computing and systems such as Amazon Web Services (AWS) and Google Compute Engine, it is now possible for many organizations to use VTK/ParaView in a distributed, customized, relatively inexpensive, on-demand basis to meet computational needs.
 </p>
 <p>
  However, as we all know, the computing industry is not standing still. The field of parallel computing is advancing rapidly due to innovations in graphics processor unit (GPU) and multi-core technologies. With the plateauing of serial clock speeds, due to power and other physical constraints, chip manufacturers are adding computing capacity in the form of additional computing cores and vectorized processing units. While such hardware represents a significant leap in computing potential—with the distinct possibility of a dawning exascale computing era—these hardware advances pose significant challenges to software systems. Not only are popular programming languages unsuited for most parallel computing applications, but the diversity of emerging parallel approaches makes it very difficult to create general programs that can take advantage of different hardware and software libraries across a variety of platforms.
 </p>
 <p>
  There is also the algorithm design challenge: Many developers simply adapt applications that were initially developed in a serial computing environment. Such adaptations typically use relatively limited task- and data-parallel approaches that require significant synchronization and inter-process communication, as well as locks and mutexes to access serial data structures. These approaches often do not scale well on massively-parallel hardware. Instead, in the interest of scaling across the emerging parallel hardware, developers must rethink parallel algorithms that may be slower and less efficient at a small scale, but that execute efficiently as data becomes large.
 </p>
 <p>
  These challenges are significant and require a concerted effort to realize the full potential of parallel computing. The VTK/ParaView community—led by Dr. Berk Geveci at Kitware, in collaboration with prestigious computing organizations such as Department of Energy National Laboratories—is taking these challenges to heart and has developed a broad vision for the future. This vision is one that depends on a multi-pronged approach to address differing parallel computing needs. The major components of this vision include the following:
 </p>
 <p>
  <strong>
   1. vtkSMPTools
  </strong>
 </p>
 <p>
  This is an abstraction for threaded processing, which under the hood uses different libraries such as Threaded Building Blocks (TBB), OpenMP, and X-Kaapi. The typical target application is coarse-grained shared-memory computing as provided by mainstream multi-core, threaded central processing units (CPUs) such as Intel’s i5 and i7 architectures.
 </p>
 <p>
  <strong>
   2. VTK-m
  </strong>
 </p>
 <p>
  This is a toolkit of scientific visualization algorithms for emerging processor architectures (GPUs and coprocessors). VTK-m is designed for fine-grained concurrency and provides abstract data and execution models that can be utilized to construct a variety of scalable algorithms.
 </p>
 <p>
  <strong>
   3. New Algorithms
  </strong>
 </p>
 <p>
  This component requires the redesign and implementation of algorithms and data structures that best take advantage of new parallel computing hardware and libraries. To do so, it is necessary to identify essential capabilities for a variety of visualization and data analysis tasks.
 </p>
 <p>
  Currently, all of these components are under active development. This article addresses
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  due to its relative simplicity and maturity. Future articles will describe the other components (VTK-m and new algorithms) as they mature and are further incorporated into VTK and ParaView.
 </p>
 <p>
  <span style="font-size: 14px;">
   <span style="color: #000080;">
    <strong>
     vtkSMPTools
    </strong>
   </span>
  </span>
 </p>
 <p>
  The best place to start learning about
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  is a short but informative description, titled “Parallel Processing with the SMP Framework in VTK” [3]. As stated in the introduction to this document, the objective of the symmetric multiprocessing (SMP) framework is to provide a basic infrastructure for the easy development of shared-memory parallel algorithms in VTK. The resulting framework is quite simple, supporting the following:
 </p>
 <ul>
  <li>
   atomic integers and associated operations
  </li>
  <li>
   thread local storage
  </li>
  <li>
   parallel building blocks such as parallel
   <span style="font-family: courier;">
    for
   </span>
   loops
  </li>
 </ul>
 <p>
  A noteworthy feature of
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  is that it defines an abstraction to a variety of underlying threading systems. At compile time (using the CMake advanced option
  <span style="font-family: courier;">
   VTK_SMP_IMPLEMENTATION_TYPE
  </span>
  ), it is possible to choose one of several possible threading facilities. Currently, the choices are the Intel TBB library [4], Kaapi [5], Simple (soon to be replaced by the OpenMP backend), and Sequential (as in serial processing). As noted, OpenMP is being added to the mix and will be available soon. In addition, key general-purpose algorithms such as
  <span style="font-family: courier;">
   parallel_sort
  </span>
  will be supported by
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  .
 </p>
 <p>
  With
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  , rather than worrying about scheduling and balancing work among multiple threads, a developer can focus on writing algorithms as a sequence of small, independent tasks. vtkSMPTools takes care of distributing the work to the underlying thread resources.
 </p>
 <p>
  <span style="font-size: 14px;">
   <span style="color: #000080;">
    <strong>
     Parallel For()
    </strong>
   </span>
  </span>
 </p>
 <p>
  The
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  framework implements a thin wrapper around existing tools such as TBB and OpenMP, and it provides a simple application programming interface (API) for writing parallel code. Useful algorithms that scale well can be created using the parallel for loop
  <span style="font-family: courier;">
   vtkSMPTools::For()
  </span>
  . The arguments to
  <span style="font-family: courier;">
   For()
  </span>
  consist of start and end parameters, which are expressed as
  <span style="font-family: courier;">
   vtkIdType
  </span>
  integers and define the semi-open range [start,end), and a functor to be executed over this range. The functor is a C++ class with an implementation of
  <span style="font-family: courier;">
   operator()
  </span>
  . Optionally, a “chunk” or “grain” size can be provided that offers a hint as to how to divide up the problem for effective load balancing versus scheduling overhead.
 </p>
 <p>
  In practice, the parallel
  <span style="font-family: courier;">
   for
  </span>
  construct looks like this:
 </p>
 <!-- Crayon Syntax Highlighter v_2.7.2_beta -->
 <div class="crayon-syntax crayon-theme-coy crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c41e82825580506827968" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 25px !important;">
  <div class="crayon-plain-wrap">
   <textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 25px !important;" wrap="soft">
vtkSomeFunctor func;
vtkSMPTools::For(begin,end,func);</textarea>
  </div>
  <div class="crayon-main">
   <table class="crayon-table">
    <tr class="crayon-row">
     <td class="crayon-nums " data-settings="show">
      <div class="crayon-nums-content" style="font-size: 16px !important; line-height: 25px !important;">
       <div class="crayon-num" data-line="crayon-5c41e82825580506827968-1">
        1
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825580506827968-2">
        2
       </div>
      </div>
     </td>
     <td class="crayon-code">
      <div class="crayon-pre" style="font-size: 16px !important; line-height: 25px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
       <div class="crayon-line" id="crayon-5c41e82825580506827968-1">
        <span class="crayon-e">
         vtkSomeFunctor
        </span>
        <span class="crayon-v">
         func
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825580506827968-2">
        <span class="crayon-v">
         vtkSMPTools
        </span>
        <span class="crayon-o">
         ::
        </span>
        <span class="crayon-st">
         For
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-v">
         begin
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-st">
         end
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-v">
         func
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
      </div>
     </td>
    </tr>
   </table>
  </div>
 </div>
 <!-- [Format Time: 0.0042 seconds] -->
 <p>
  This high-level specification of the computation enables the different backends to employ various scheduling strategies for optimal performance. For example, the OpenMP backend supports static, dynamic, guided, or implementation-dependent default scheduling strategies, which can be selected at runtime by setting the
  <span style="font-family: courier;">
   OMP_SCHEDULE
  </span>
  environment variable. (Please refer to the OpenMP specification for a description of these strategies.) The TBB backend implements a technique called work stealing [6]. In work stealing, each thread has its own work pool, from which it takes the next task to execute and adds any new tasks that are generated. Using local queues removes contention, which is present when using a single work pool. When a thread has exhausted its own pool, it steals more work from other threads’ pools, and hence, balances the workload.
 </p>
 <p>
  The optional grain size parameter to the parallel for construct provides a hint regarding the granularity of the computation to be performed. This is useful for equilibrium between scheduling overhead and load balancing. Parallelism is achieved by splitting the input range into smaller sub-ranges based on the grain size and assigning these sub-ranges to the threads. If the grain size is too low, the functor is invoked many times, and the overhead of invocation adds up, resulting in poor performance. If the grain size is too high, the overhead is reduced. This can result in poor load balancing, as some threads may finish their work sooner (if particular sub-ranges are less demanding) and become idle, since there are not enough sub-ranges to keep them fed.
 </p>
 <p>
  The grain size depends on the type of computation, and it is recommended that an appropriate value be specified. The TBB backend can chose a grain size heuristically (and adaptively adjust it), but this feature is not available on other backends discussed in this article. Other backends simply assign tasks based on a small multiple of the number of available threads.
 </p>
 <p>
  <span style="font-size: 14px;">
   <span style="color: #000080;">
    <strong>
     Example
    </strong>
   </span>
  </span>
 </p>
 <p>
  The following is a simple example, inspired by the VTK class
  <span style="font-family: courier;">
   vtkWarpVector
  </span>
  , for creating the class
  <span style="font-family: courier;">
   vtkSMPWarpVector
  </span>
  .
  <span style="font-family: courier;">
   vtkSMPWarpVector
  </span>
  simply computes new point coordinates by displacing input points by an associated, scaled vector field. First, the functor is defined, including the overloading
  <span style="font-family: courier;">
   operator()
  </span>
  , which in this case is templated over the type of points and vectors.
 </p>
 <!-- Crayon Syntax Highlighter v_2.7.2_beta -->
 <div class="crayon-syntax crayon-theme-coy crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c41e82825596098485906" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 25px !important;">
  <div class="crayon-plain-wrap">
   <textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 25px !important;" wrap="soft">
#include "vtkSMPTools.h"

template &lt;class T1, class T2&gt;
class vtkSMPWarpVectorOp
{
  public:
  T1 *InPoints;
  T1 *OutPoints;
  T2 *InVector;
  T1 scaleFactor;
  void  operator()(vtkIdType begin, vtkIdType end)
  {
    T1* inPts = this-&gt;InPoints + 3*begin;
    T1* outPts = this-&gt;OutPoints + 3*begin;
    T2* inVec = this-&gt;InVector + 3*begin;
    T1 sf = this-&gt;scaleFactor;
    vtkIdType size = 3*(end-begin);
    vtkIdType nend = begin + size;

    for (vtkIdType index = begin; index &lt; nend; index++)
    {
      *outPts = *inPts + sf * (T1)(*inVec);
      inPts++; outPts++; inVec++;
    }
  }
};</textarea>
  </div>
  <div class="crayon-main">
   <table class="crayon-table">
    <tr class="crayon-row">
     <td class="crayon-nums " data-settings="show">
      <div class="crayon-nums-content" style="font-size: 16px !important; line-height: 25px !important;">
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-1">
        1
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-2">
        2
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-3">
        3
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-4">
        4
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-5">
        5
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-6">
        6
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-7">
        7
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-8">
        8
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-9">
        9
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-10">
        10
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-11">
        11
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-12">
        12
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-13">
        13
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-14">
        14
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-15">
        15
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-16">
        16
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-17">
        17
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-18">
        18
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-19">
        19
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-20">
        20
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-21">
        21
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-22">
        22
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-23">
        23
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-24">
        24
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-25">
        25
       </div>
       <div class="crayon-num" data-line="crayon-5c41e82825596098485906-26">
        26
       </div>
      </div>
     </td>
     <td class="crayon-code">
      <div class="crayon-pre" style="font-size: 16px !important; line-height: 25px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
       <div class="crayon-line" id="crayon-5c41e82825596098485906-1">
        <span class="crayon-p">
         #include "vtkSMPTools.h"
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-2">
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-3">
        <span class="crayon-v">
         template
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-t">
         class
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         T1
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-t">
         class
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         T2
        </span>
        <span class="crayon-o">
         &gt;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-4">
        <span class="crayon-t">
         class
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         vtkSMPWarpVectorOp
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-5">
        <span class="crayon-sy">
         {
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-6">
        <span class="crayon-h">
        </span>
        <span class="crayon-m">
         public
        </span>
        <span class="crayon-o">
         :
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-7">
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         T1 *
        </span>
        <span class="crayon-v">
         InPoints
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-8">
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         T1 *
        </span>
        <span class="crayon-v">
         OutPoints
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-9">
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         T2 *
        </span>
        <span class="crayon-v">
         InVector
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-10">
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         T1
        </span>
        <span class="crayon-v">
         scaleFactor
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-11">
        <span class="crayon-h">
        </span>
        <span class="crayon-t">
         void
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         operator
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-e">
         vtkIdType
        </span>
        <span class="crayon-v">
         begin
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         vtkIdType
        </span>
        <span class="crayon-st">
         end
        </span>
        <span class="crayon-sy">
         )
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-12">
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         {
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-13">
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         T1*
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         inPts
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-r">
         this
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-v">
         InPoints
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         +
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-cn">
         3
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-v">
         begin
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-14">
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         T1*
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         outPts
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-r">
         this
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-v">
         OutPoints
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         +
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-cn">
         3
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-v">
         begin
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-15">
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         T2*
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         inVec
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-r">
         this
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-v">
         InVector
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         +
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-cn">
         3
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-v">
         begin
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-16">
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         T1
        </span>
        <span class="crayon-v">
         sf
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-r">
         this
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-v">
         scaleFactor
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-17">
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         vtkIdType
        </span>
        <span class="crayon-v">
         size
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-cn">
         3
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-st">
         end
        </span>
        <span class="crayon-o">
         -
        </span>
        <span class="crayon-v">
         begin
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-18">
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         vtkIdType
        </span>
        <span class="crayon-v">
         nend
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         begin
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         +
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         size
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-19">
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-20">
        <span class="crayon-h">
        </span>
        <span class="crayon-st">
         for
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-e">
         vtkIdType
        </span>
        <span class="crayon-v">
         index
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         begin
        </span>
        <span class="crayon-sy">
         ;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         index
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         nend
        </span>
        <span class="crayon-sy">
         ;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         index
        </span>
        <span class="crayon-o">
         ++
        </span>
        <span class="crayon-sy">
         )
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-21">
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         {
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-22">
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-v">
         outPts
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-v">
         inPts
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         +
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         sf *
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-v">
         T1
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-v">
         inVec
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-23">
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         inPts
        </span>
        <span class="crayon-o">
         ++
        </span>
        <span class="crayon-sy">
         ;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         outPts
        </span>
        <span class="crayon-o">
         ++
        </span>
        <span class="crayon-sy">
         ;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         inVec
        </span>
        <span class="crayon-o">
         ++
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-24">
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         }
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-25">
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         }
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e82825596098485906-26">
        <span class="crayon-sy">
         }
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
      </div>
     </td>
    </tr>
   </table>
  </div>
 </div>
 <!-- [Format Time: 0.0008 seconds] -->
 <p>
 </p>
 <p>
  Next, in the VTK class, the functor is used as follows (in the templated execution method
  <span style="font-family: courier;">
   vtkSMPWarpVectorExecute2
  </span>
  ):
 </p>
 <!-- Crayon Syntax Highlighter v_2.7.2_beta -->
 <div class="crayon-syntax crayon-theme-coy crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c41e8282559a354752354" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 25px !important;">
  <div class="crayon-plain-wrap">
   <textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 25px !important;" wrap="soft">
template &lt;class T1, class T2&gt;
void vtkSMPWarpVectorExecute2(vtkSMPWarpVector *self, T1 *inIter, T1 *outIter,
T2 *inVecIter, vtkIdType size)
{
  vtkSMPWarpVectorOp&lt;T1, T2&gt; func;
  func.InPoints = inIter;
  func.OutPoints = outIter;
  func.InVector = inVecIter;
  func.scaleFactor = (T1)self-&gt;GetScaleFactor();

  vtkSMPTools::For(0, size, func);
}</textarea>
  </div>
  <div class="crayon-main">
   <table class="crayon-table">
    <tr class="crayon-row">
     <td class="crayon-nums " data-settings="show">
      <div class="crayon-nums-content" style="font-size: 16px !important; line-height: 25px !important;">
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-1">
        1
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-2">
        2
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-3">
        3
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-4">
        4
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-5">
        5
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-6">
        6
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-7">
        7
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-8">
        8
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-9">
        9
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-10">
        10
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-11">
        11
       </div>
       <div class="crayon-num" data-line="crayon-5c41e8282559a354752354-12">
        12
       </div>
      </div>
     </td>
     <td class="crayon-code">
      <div class="crayon-pre" style="font-size: 16px !important; line-height: 25px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-1">
        <span class="crayon-v">
         template
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-t">
         class
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         T1
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-t">
         class
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         T2
        </span>
        <span class="crayon-o">
         &gt;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-2">
        <span class="crayon-t">
         void
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         vtkSMPWarpVectorExecute2
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-e ">
         vtkSMPWarpVector *
        </span>
        <span class="crayon-r">
         self
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         T1 *
        </span>
        <span class="crayon-v">
         inIter
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e ">
         T1 *
        </span>
        <span class="crayon-v">
         outIter
        </span>
        <span class="crayon-sy">
         ,
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-3">
        <span class="crayon-e ">
         T2 *
        </span>
        <span class="crayon-v">
         inVecIter
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         vtkIdType
        </span>
        <span class="crayon-v">
         size
        </span>
        <span class="crayon-sy">
         )
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-4">
        <span class="crayon-sy">
         {
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-5">
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         vtkSMPWarpVectorOp
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-v">
         T1
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         T2
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         func
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-6">
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         func
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-v">
         InPoints
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         inIter
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-7">
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         func
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-v">
         OutPoints
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         outIter
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-8">
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         func
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-v">
         InVector
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         inVecIter
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-9">
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         func
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-v">
         scaleFactor
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-v">
         T1
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-r">
         self
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         GetScaleFactor
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-10">
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-11">
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         vtkSMPTools
        </span>
        <span class="crayon-o">
         ::
        </span>
        <span class="crayon-st">
         For
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-cn">
         0
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         size
        </span>
        <span class="crayon-sy">
         ,
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         func
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e8282559a354752354-12">
        <span class="crayon-sy">
         }
        </span>
       </div>
      </div>
     </td>
    </tr>
   </table>
  </div>
 </div>
 <!-- [Format Time: 0.0005 seconds] -->
 <p>
  (The full implementation is available in
  <span style="font-family: courier;">
   Filters/SMP/vtkSMPWarpVector.h/.cxx
  </span>
  .)
 </p>
 <p>
  Thus, with very few lines of code, a scalable, threaded, load-balanced algorithm has been implemented!
 </p>
 <p>
  <span style="font-size: 14px;">
   <span style="color: #000080;">
    <strong>
     Advanced Capabilities and Future Work
    </strong>
   </span>
  </span>
 </p>
 <p>
  In an ideal parallel algorithm, threads operate on data without retaining state between invocations, and they read from and write to shared memory without contention. In the example above, no initialization or final reduction is required on each thread, and writing to memory is uniquely determined by the point ID on which the thread is working.
 </p>
 <p>
  In more realistic applications, however, many algorithms require synchronization, initialization, and maintenance of local state. To provide these capabilities,
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  offers the following tools. (For more information, see the previously referenced document, “Parallel Processing with the SMP Framework in VTK.”)
 </p>
 <p>
  <strong>
   1. Thread local storage
  </strong>
 </p>
 <p>
  Thread local storage is used to store VTK instances and other objects. Developers can instantiate objects using
  <br/>
  <span style="font-family: courier;">
   vtkSMPThreadLocal
  </span>
  and
  <span style="font-family: courier;">
   vtkSMPThreadLocalObject
  </span>
  (for VTK classes that require VTK-specific allocation and deletion). These objects are created once per thread, and they persist as each edge processes its assigned tasks. Implementing such local thread objects is a great way to accumulate output over multiple thread invocations.
 </p>
 <p>
  <strong>
   2. Functor initialization and reduction
  </strong>
 </p>
 <p>
  Functor initialization and reduction is typically used in combination with the creation of local thread objects, since these objects must often be initialized. The results are combined (or reduced) into final form as execution concludes.
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  provides these capabilities by invoking the optional
  <span style="font-family: courier;">
   Initialize()
  </span>
  and
  <span style="font-family: courier;">
   Reduce()
  </span>
  methods (defined by the functor in combination with the
  <span style="font-family: courier;">
   operator()
   <span style="font-family: courier;">
    method).
   </span>
  </span>
 </p>
 <p>
  <strong>
   3. Atomic integers
  </strong>
 </p>
 <p>
  Atomic integers can be used to ensure data integrity when reading from and writing to shared memory. vkSMPTools supports a subset of the C++11 atomic API, mainly the operators ++, –, +=, -=, load, and store. These integers can be used when multiple threads must access and manipulate a common data structure.
 </p>
 <p>
  Currently, many VTK algorithms are being rewritten with these simple constructs with good performance scaling. New algorithms are also being designed and implemented (both in the
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  framework and in VTK-m). If you are interested in realizing performance gains in your own code, we recommend that you build VTK with
  <span style="font-family: courier;">
   vtkSMPTools
  </span>
  enabled. (At the moment, TBB is the most popular.) We also look forward to receiving contributions of your new and old algorithms implemented using this framework.
 </p>
 <p>
  <span style="font-size: 14px;">
   <span style="color: #000080;">
    <strong>
     References
    </strong>
   </span>
  </span>
 </p>
 <p>
  [1]
  <a href="https://vimeo.com/120504264">
   https://vimeo.com/120504264
  </a>
  <br/>
  [2]
  <a href="http://www.paraview.org/web">
   http://www.paraview.org/web
  </a>
  <br/>
  [3]
  <a href="http://www.vtk.org/Wiki/images/3/3b/VTK_SMP_Guide.pdf">
   http://www.vtk.org/Wiki/images/3/3b/VTK_SMP_Guide.pdf
  </a>
  <br/>
  [4]
  <a href="https://www.threadingbuildingblocks.org">
   https://www.threadingbuildingblocks.org
  </a>
  <br/>
  [5]
  <a href="https://github.com/perarnau/xkaapi/blob/kcomputer/README">
   https://github.com/perarnau/xkaapi/blob/kcomputer/README
  </a>
  <br/>
  [6]
  <a href="http://en.wikipedia.org/wiki/Work_stealing">
   http://en.wikipedia.org/wiki/Work_stealing
  </a>
 </p>
 <p>
  <a href="/source/files/4_155500049.jpg" rel="noopener" target="_blank">
   <img alt="" src="https://blog.kitware.com/source/files/Small.4_155500049.jpg" style="width: 100px; float: left; padding-right: 10px; height: 125px;"/>
  </a>
 </p>
 <p>
  <strong>
   Will Schroeder
  </strong>
  is president and CEO of Kitware. His role is to identify technology and business opportunities and to obtain the necessary support for Kitware to meet these opportunities. Will also provides technical leadership for large open-source projects such as the National Library of Medicine Insight Toolkit project and VTK.
 </p>
 <p>
 </p>
 <p>
  <a href="/source/files/4_351470209.jpg" rel="noopener" target="_blank">
   <img alt="" src="https://blog.kitware.com/source/files/Small.4_351470209.jpg" style="width: 100px; float: left; padding-right: 10px;"/>
  </a>
 </p>
 <p>
  <strong>
   Sujin Philip
  </strong>
  is a member of Kitware’s Scientific Computing team. His background is in using massive and hybrid parallelism (combining message passing, shared memory multithreading, and GPGU) for scientific computing and visualization applications.
 </p>
 <p>
 </p>
 <p>
  <a href="/source/files/4_2034599387.jpg" rel="noopener" target="_blank">
   <img alt="" src="https://blog.kitware.com/source/files/Small.4_2034599387.jpg" style="width: 100px; float: left; padding-right: 10px;"/>
  </a>
 </p>
 <p>
  <strong>
   Berk Geveci
  </strong>
  is the Senior Director of Scientific Computing at Kitware. He is one of the lead developers of the ParaView visualization application and VTK. His research interests include large-scale parallel computing, computational dynamics, finite elements, and visualization algorithms.
 </p>
</div>
