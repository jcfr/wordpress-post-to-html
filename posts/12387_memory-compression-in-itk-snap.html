<meta charset="utf-8">
<div class="entry-content">
 <p>
  <span style="color: rgb(0, 0, 0); font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
   ITK-SNAP is a software application used to segment structures in 3D medical images. It is the product of a decade-long collaboration between Paul Yushkevich, Ph.D., of the
  </span>
  <a class="urllink" href="http://picsl.upenn.edu/" rel="nofollow" style="font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;" target="_blank">
   Penn Image Computing and Science Laboratory (PICSL)
  </a>
  <span style="color: rgb(0, 0, 0); font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
   at the University of Pennsylvania, and Guido Gerig, Ph.D., of the
  </span>
  <a class="urllink" href="http://www.sci.utah.edu/" rel="nofollow" style="font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;" target="_blank">
   Scientific Computing and Imaging Institute (SCI)
  </a>
  <span style="color: rgb(0, 0, 0); font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
   at the University of Utah, whose vision was to create a tool that would be dedicated to a specific function, segmentation, and would be easy to use and learn. ITK-SNAP is free, open-source, and multi-platform.
  </span>
 </p>
 <p>
  <span style="color: rgb(0, 0, 0); font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
   Internally, ITK-SNAP keeps both image grey-values and segmentation labels as 16-bit integers. It also keeps an undo image, so normally 6 bytes are allocated for each image voxel. The segmentation layer usually contains small number of labels, and they are grouped together into large chunks, which makes it a perfect target for run-length encoding (RLE) to save working memory (RAM). The savings are significant for large images.
  </span>
 </p>
 <table border="0" cellspacing="0">
  <colgroup width="89">
  </colgroup>
  <colgroup width="157">
  </colgroup>
  <colgroup width="140">
  </colgroup>
  <colgroup width="207">
  </colgroup>
  <colgroup width="143">
  </colgroup>
  <colgroup width="136">
  </colgroup>
  <colgroup width="107">
  </colgroup>
  <tbody>
   <tr>
    <td height="21" style="text-align: right;">
     <strong>
      ITK-SNAP Version
     </strong>
    </td>
    <td style="text-align: right;">
     <strong>
      Image (Size MVox)
     </strong>
    </td>
    <td style="text-align: right;">
     <strong>
      Number of labels
     </strong>
    </td>
    <td style="text-align: right;">
     <strong>
      Private Working Set (MB)
     </strong>
    </td>
    <td style="text-align: right;">
     <strong>
      Commit Size (MB)
     </strong>
    </td>
    <td style="text-align: right;">
     <strong>
      PWS difference
     </strong>
    </td>
    <td style="text-align: right;">
     <strong>
      Commit difference
     </strong>
    </td>
   </tr>
   <tr>
    <td align="right" height="21">
     3.x nightly
    </td>
    <td align="right" sdnum="1033;" sdval="0">
     None (0)
    </td>
    <td align="right" sdnum="1033;" sdval="0">
     0
    </td>
    <td align="right" sdnum="1033;0;0" sdval="75.06640625">
     75
    </td>
    <td align="right" sdnum="1033;0;0" sdval="154.42578125">
     154
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="1">
     100%
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="1">
     100%
    </td>
   </tr>
   <tr>
    <td align="right" height="21">
     3.x nightly
    </td>
    <td align="right" sdnum="1033;" sdval="116">
     vb-seg (116)
    </td>
    <td align="right" sdnum="1033;" sdval="9">
     9
    </td>
    <td align="right" sdnum="1033;0;0" sdval="625.97265625">
     626
    </td>
    <td align="right" sdnum="1033;0;0" sdval="731.0625">
     731
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="1">
     100%
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="1">
     100%
    </td>
   </tr>
   <tr>
    <td align="right" height="21">
     3.x nightly
    </td>
    <td align="right" sdnum="1033;" sdval="390">
     wb-seg (390)
    </td>
    <td align="right" sdnum="1033;" sdval="58672">
     58672
    </td>
    <td align="right" sdnum="1033;0;0" sdval="2911.6640625">
     2912
    </td>
    <td align="right" sdnum="1033;0;0" sdval="3058.4453125">
     3058
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="1">
     100%
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="1">
     100%
    </td>
   </tr>
   <tr>
    <td align="right" height="21">
     dev_3.6
    </td>
    <td align="right" sdnum="1033;" sdval="0">
     <span style="line-height: 20.8000011444092px; text-align: -webkit-right;">
      None (0)
     </span>
    </td>
    <td align="right" sdnum="1033;" sdval="0">
     0
    </td>
    <td align="right" sdnum="1033;0;0" sdval="79.6015625">
     80
    </td>
    <td align="right" sdnum="1033;0;0" sdval="164.8359375">
     165
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="0.0604152573242442">
     <b>
      <font color="#FF3333">
       +6%
      </font>
     </b>
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="0.0674120355146333">
     <b>
      <font color="#FF3333">
       +7%
      </font>
     </b>
    </td>
   </tr>
   <tr>
    <td align="right" height="21">
     dev_3.6
    </td>
    <td align="right" sdnum="1033;" sdval="116">
     <span style="line-height: 20.8000011444092px; text-align: -webkit-right;">
      vb-seg (116)
     </span>
    </td>
    <td align="right" sdnum="1033;" sdval="9">
     9
    </td>
    <td align="right" sdnum="1033;0;0" sdval="403.453125">
     403
    </td>
    <td align="right" sdnum="1033;0;0" sdval="507.85546875">
     508
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="-0.355478037304445">
     <b>
      <font color="#00CC00">
       -36%
      </font>
     </b>
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="-0.305318671454219">
     <b>
      <font color="#00CC00">
       -31%
      </font>
     </b>
    </td>
   </tr>
   <tr>
    <td align="right" height="21">
     dev_3.6
    </td>
    <td align="right" sdnum="1033;" sdval="390">
     <span style="line-height: 20.8000011444092px; text-align: -webkit-right;">
      wb-seg (390)
     </span>
    </td>
    <td align="right" sdnum="1033;" sdval="58672">
     58672
    </td>
    <td align="right" sdnum="1033;0;0" sdval="2032.05859375">
     2032
    </td>
    <td align="right" sdnum="1033;0;0" sdval="2266.5859375">
     2267
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="-0.302097168446952">
     <b>
      <font color="#00CC00">
       -30%
      </font>
     </b>
    </td>
    <td align="right" sdnum="1033;0;0%" sdval="-0.258909116917552">
     <b>
      <font color="#00CC00">
       -26%
      </font>
     </b>
    </td>
   </tr>
  </tbody>
 </table>
 <p>
  <span style="color: rgb(0, 0, 0); font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
   The above table depicts memory savings of RLE implementation. 6% higher memory consumption without any image loaded probably comes from differences in compiler used (3.x nightly was downloaded, dev_3.6 locally compiled). The private working set is physical memory used, commit size is total allocated memory of the process. The decrease is slightly less than a third. Considering that about a third of the memory is dedicated to segmentation image, it means that RLE is very effective for the two typical test images used. In fact, the RLE compression ratio is 44x and 20x for the two test images used!
  </span>
 </p>
 <p>
  <span style="color: rgb(0, 0, 0); font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
   A run-length encoded image type (RLEImage) was implemented, designed to fit into Insight ToolKit (ITK), along with accompanying iterators and a region of interest image filter. Region of interest image filter has three scpecialized variants, so it can be used both to extract a subregion from an RLEImage, as well as convert between itk::Image and RLEImage (optionally with a subregion operation).
  </span>
 </p>
 <p>
  <span style="color: rgb(0, 0, 0); font-family: Verdana; font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
   As image slicing is executed whenever mouse is scrolled or clicked, special care has been taken to keep it fast. To this end, slicing filter has a multithreaded implementation. For slicing planes which are parallel to RLE axis it is even faster than slicing without memory compression!
  </span>
 </p>
 <table border="0" cellspacing="0">
  <colgroup width="165">
  </colgroup>
  <colgroup width="66">
  </colgroup>
  <colgroup span="2" width="41">
  </colgroup>
  <colgroup width="51">
  </colgroup>
  <colgroup span="7" width="56">
  </colgroup>
  <colgroup width="47">
  </colgroup>
  <colgroup width="37">
  </colgroup>
  <colgroup span="4" width="47">
  </colgroup>
  <colgroup span="2" width="37">
  </colgroup>
  <tbody>
   <tr>
    <td align="center" colspan="2" height="21" valign="middle">
     Durations in milliseconds
    </td>
    <td align="center" colspan="3" valign="middle">
     <b>
      Dimensions
     </b>
    </td>
    <td align="center" colspan="3" valign="middle">
     <b>
      itk::LabelMap
     </b>
    </td>
    <td align="center" colspan="3" valign="middle">
     <b>
      naiveRLE
     </b>
    </td>
    <td align="center" bgcolor="#99FF99" colspan="3" valign="middle">
     <b>
      SNAP+RLE
     </b>
    </td>
    <td align="center" bgcolor="#FF9999" colspan="3" valign="middle">
     <b>
      SNAP-noRLE
     </b>
    </td>
    <td align="center" colspan="3" valign="middle">
     <b>
      pureITK
     </b>
    </td>
   </tr>
   <tr>
    <td align="left" height="21">
     <b>
      Image
     </b>
    </td>
    <td align="left">
     <b>
      Labels
     </b>
    </td>
    <td align="right">
     <b>
      X
     </b>
    </td>
    <td align="right">
     <b>
      Y
     </b>
    </td>
    <td align="right">
     <b>
      Z
     </b>
    </td>
    <td align="right">
     <b>
      X
     </b>
    </td>
    <td align="right">
     <b>
      Y
     </b>
    </td>
    <td align="right">
     <b>
      Z
     </b>
    </td>
    <td align="right">
     <b>
      X
     </b>
    </td>
    <td align="right">
     <b>
      Y
     </b>
    </td>
    <td align="right">
     <b>
      Z
     </b>
    </td>
    <td align="right" bgcolor="#99FF99">
     <b>
      X
     </b>
    </td>
    <td align="right" bgcolor="#99FF99">
     <b>
      Y
     </b>
    </td>
    <td align="right" bgcolor="#99FF99">
     <b>
      Z
     </b>
    </td>
    <td align="right" bgcolor="#FF9999">
     <b>
      X
     </b>
    </td>
    <td align="right" bgcolor="#FF9999">
     <b>
      Y
     </b>
    </td>
    <td align="right" bgcolor="#FF9999">
     <b>
      Z
     </b>
    </td>
    <td align="right">
     <b>
      X
     </b>
    </td>
    <td align="right">
     <b>
      Y
     </b>
    </td>
    <td align="right">
     <b>
      Z
     </b>
    </td>
   </tr>
   <tr>
    <td align="left" height="21">
     MRIcrop-seg.gipl.gz
    </td>
    <td align="right" sdnum="1033;" sdval="9">
     9
    </td>
    <td align="right" sdnum="1033;" sdval="78">
     78
    </td>
    <td align="right" sdnum="1033;" sdval="110">
     110
    </td>
    <td align="right" sdnum="1033;" sdval="64">
     64
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="5.10716">
     5.1
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="3.93742">
     3.9
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="4.09919">
     4.1
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="3.04422">
     3.0
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="2.65142">
     2.7
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="2.68281">
     2.7
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="1.32356">
     1.3
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="0.211239">
     0.2
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="0.277042">
     0.3
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="0.450993">
     0.5
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="0.368323">
     0.4
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="0.498473">
     0.5
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="2.03481">
     2.0
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="0.298943">
     0.3
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="0.340521">
     0.3
    </td>
   </tr>
   <tr>
    <td align="left" height="21">
     brainParc.mha
    </td>
    <td align="right" sdnum="1033;" sdval="114">
     114
    </td>
    <td align="right" sdnum="1033;" sdval="256">
     256
    </td>
    <td align="right" sdnum="1033;" sdval="256">
     256
    </td>
    <td align="right" sdnum="1033;" sdval="256">
     256
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="50.9746">
     51.0
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="39.1937">
     39.2
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="38.9673">
     39.0
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="33.2742">
     33.3
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="28.2939">
     28.3
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="28.2285">
     28.2
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="11.7198">
     11.7
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="1.0577">
     1.1
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="1.0097">
     1.0
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="5.23704">
     5.2
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="3.58514">
     3.6
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="3.55083">
     3.6
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="10.3322">
     10.3
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="0.459477">
     0.5
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="0.393823">
     0.4
    </td>
   </tr>
   <tr>
    <td align="left" height="21">
     vb-seg.mha
    </td>
    <td align="right" sdnum="1033;" sdval="9">
     9
    </td>
    <td align="right" sdnum="1033;" sdval="640">
     640
    </td>
    <td align="right" sdnum="1033;" sdval="633">
     633
    </td>
    <td align="right" sdnum="1033;" sdval="299">
     299
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="105.933">
     105.9
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="71.5426">
     71.5
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="94.8159">
     94.8
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="67.9529">
     68.0
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="61.0509">
     61.1
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="63.1129">
     63.1
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="30.0015">
     30.0
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="2.87865">
     2.9
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="5.59556">
     5.6
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="22.5333">
     22.5
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="10.3557">
     10.4
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="21.7886">
     21.8
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="26.2802">
     26.3
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="0.589859">
     0.6
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="0.696069">
     0.7
    </td>
   </tr>
   <tr>
    <td align="left" height="21">
     wb-seg.nrrd
    </td>
    <td align="right" sdnum="1033;" sdval="58672">
     58672
    </td>
    <td align="right" sdnum="1033;" sdval="512">
     512
    </td>
    <td align="right" sdnum="1033;" sdval="512">
     512
    </td>
    <td align="right" sdnum="1033;" sdval="1559">
     1559
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="993.553">
     993.6
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="912.094">
     912.1
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="874.719">
     874.7
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="472.055">
     472.1
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="392.582">
     392.6
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="386.581">
     386.6
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="154.178">
     154.2
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="15.4095">
     15.4
    </td>
    <td align="right" bgcolor="#99FF99" sdnum="1033;0;0.0" sdval="8.11598">
     8.1
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="73.8678">
     73.9
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="43.3922">
     43.4
    </td>
    <td align="right" bgcolor="#FF9999" sdnum="1033;0;0.0" sdval="14.0739">
     14.1
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="79.0641">
     79.1
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="1.40115">
     1.4
    </td>
    <td align="right" sdnum="1033;0;0.0" sdval="0.588422">
     0.6
    </td>
   </tr>
  </tbody>
 </table>
 <p>
  <font color="#000000" face="Verdana">
   <span style="font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
    The above table shows average slicing duration (in milliseconds) of several different slicing implementations. ITK-SNAP's pre-existing slicing code without memory compression is somewhat slower than pure ITK implementation because it does image flipping on the fly, and it is single-threaded too. The case of slicing perpendicular to X (RLE axis) is slower than non-compressed version, but only about twice slower. Slicing along other axes is faster, in same cases more than twice faster, so dual-core multi-threading alone cannot explain it. My conclusion is that taking advantage of RLE structure is reducing number of memory reads, which is the expensive operation in today's computers.
   </span>
  </font>
 </p>
 <p>
  <font color="#000000" face="Verdana">
   <font color="#000000" face="Verdana">
    <span style="font-size: 13.3333330154419px; line-height: 17.7333335876465px;">
     The code is currently commited to dev_3.6 git branch of ITK-SNAP. Once its stability has been proven, it could be integrated it into Insight ToolKit (ITK). This will enable other applications to take advantage of RLE compressed images.
    </span>
   </font>
  </font>
 </p>
</div>
