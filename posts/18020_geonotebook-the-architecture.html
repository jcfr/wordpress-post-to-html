<meta charset="utf-8">
<div class="entry-content">
 <p>
  <strong>
   Chris Kotfila, Aashish Chaudhary, Petr Votava, Doruk Ozturk, Andrew Michaelis
  </strong>
 </p>
 <p>
  <span style="font-weight: 400">
   In the
   <a href="https://blog.kitware.com/geonotebook-data-driven-quality-assurance-for-geospatial-data/">
    first blog post about GeoNotebook
   </a>
   , we discussed the needs of GIS data scientists and our approach to solving those needs.  This post will delve deeper into the architecture behind GeoNotebook and how it differs from other online python execution engines for analyzing GIS data.
  </span>
 </p>
 <p>
  <span style="font-weight: 400">
   As noted in the first post, GeoNotebook uses Jupyter Notebook and Jupyter Hub to execute python commands from the web browser in order to manipulate and perform analysis on large geospatial datasets. The Notebook cells on the client side communicate with a Tornado Web Server, which in turn passes those commands to our custom GeoNotebook kernel, creating a bridge between notebook cells and the python execution environment.
  </span>
  <br/>
  <img alt="" class="alignnone size-large wp-image-18024" height="768" sizes="(max-width: 1024px) 100vw, 1024px" src="https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-1024x768.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-1024x768.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-300x225.png 300w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-768x576.png 768w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-220x165.png 220w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-250x188.png 250w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-355x266.png 355w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-730x548.png 730w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter-90x68.png 90w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-StandardJupyter.png 1440w" width="1024"/>
 </p>
 <p>
  <span style="font-weight: 400">
   Jupyter Notebook provides an abstraction over this Cell -&gt; Webserver -&gt; Kernel bridge called a
  </span>
  <a href="http://jupyter-client.readthedocs.io/en/latest/messaging.html#custom-messages">
   <span style="font-weight: 400">
    Comm channel
   </span>
  </a>
  <span style="font-weight: 400">
   . GeoNotebook makes liberal use of this Comm channel, using custom remote procedure calls to coordinate data access and analysis with data visualisation.
  </span>
 </p>
 <p>
  While GeoNotebook isn’t the only open source tool using Jupyter and other web-based analysis environments for visualizing interactive geospatial data on a map, other tools don’t fully address the workflow needs of data science geospatial visualization.  Jupyter provides the environment to execute python commands for analysis, but it can’t, by default, perform tasks such as map reprojection or rendering map data to the browser. In particular, it provides no means of caching and serving image tiles.
 </p>
 <p>
  <span style="font-weight: 400">
   Image tiles, which are generated by a tile server, are used to render large map images.  These tiles allow large amounts of data to be rendered quickly in the browser. Various resolutions of the data are styled and dynamically loaded, to provide responsive scrolling and zooming.  Traditional web-based map data, such as Google Maps, is relatively static; the same tiles are used over and over by many concurrent users, and are cached for quick retrieval when any user needs to view that area of the map.
  </span>
 </p>
 <p>
  <img alt="" class="alignnone size-large wp-image-18023 aligncenter" height="556" sizes="(max-width: 1024px) 100vw, 1024px" src="https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-1024x556.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-1024x556.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-300x163.png 300w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-768x417.png 768w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-220x119.png 220w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-250x136.png 250w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-355x193.png 355w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-730x396.png 730w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading-90x49.png 90w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-TilesLoading.png 1600w" width="1024"/>
 </p>
 <p style="text-align: center">
  <i>
   <span style="font-weight: 400">
    Map tiles being rendered
   </span>
  </i>
 </p>
 <p>
  <span style="font-weight: 400">
   Geospatial analysis, in contrast, rarely reuses the same tiles – each time the user interacts with the data, the map changes. When a python command is executed, such as re-centering the map or selecting an area for analysis, the map needs to be redrawn in order to reflect the change. A tile server must be installed for these new tiles to be generated; this requirement adds overhead for setup and maintenance, and complexity that requires a deep understanding of a wide array of geospatial technologies.
  </span>
 </p>
 <p>
  <span style="font-weight: 400">
   Our aim with GeoNotebook was to create a single, easily installed tool that can be easily set up and used by data scientists.  We designed it to be a self-contained package that includes a built-in tile server and all of the services required to load and render data. Because of the complexity of several of the system libraries needed to style and render tiles, we have included a docker container for easy use. To get it up and running:
  </span>
 </p>
 <p>
  Checkout the code:
 </p>
 <!-- Crayon Syntax Highlighter v_2.7.2_beta -->
 <div class="crayon-syntax crayon-theme-coy crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c41e4cd2bf10791813249" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 25px !important;">
  <div class="crayon-plain-wrap">
   <textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 25px !important;" wrap="soft">
&lt;span style="font-weight: 400"&gt;&amp;gt; git clone git@github.com:OpenGeoscience/geonotebook.git&lt;/span&gt;</textarea>
  </div>
  <div class="crayon-main">
   <table class="crayon-table">
    <tr class="crayon-row">
     <td class="crayon-nums " data-settings="show">
      <div class="crayon-nums-content" style="font-size: 16px !important; line-height: 25px !important;">
       <div class="crayon-num" data-line="crayon-5c41e4cd2bf10791813249-1">
        1
       </div>
      </div>
     </td>
     <td class="crayon-code">
      <div class="crayon-pre" style="font-size: 16px !important; line-height: 25px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
       <div class="crayon-line" id="crayon-5c41e4cd2bf10791813249-1">
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-e">
         span
        </span>
        <span class="crayon-v">
         style
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-s">
         "font-weight: 400"
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-o">
         &amp;
        </span>
        <span class="crayon-v">
         gt
        </span>
        <span class="crayon-sy">
         ;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-e">
         git
        </span>
        <span class="crayon-r">
         clone
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         git
        </span>
        <span class="crayon-sy">
         @
        </span>
        <span class="crayon-v">
         github
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-v">
         com
        </span>
        <span class="crayon-o">
         :
        </span>
        <span class="crayon-v">
         OpenGeoscience
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         geonotebook
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-v">
         git
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         span
        </span>
        <span class="crayon-o">
         &gt;
        </span>
       </div>
      </div>
     </td>
    </tr>
   </table>
  </div>
 </div>
 <!-- [Format Time: 0.0002 seconds] -->
 <p>
  Build the container:
 </p>
 <!-- Crayon Syntax Highlighter v_2.7.2_beta -->
 <div class="crayon-syntax crayon-theme-coy crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c41e4cd2bf18149174412" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 25px !important;">
  <div class="crayon-plain-wrap">
   <textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 25px !important;" wrap="soft">
&lt;span style="font-weight: 400"&gt;&amp;gt; &lt;/span&gt;&lt;span style="font-weight: 400"&gt;docker build -t geonotebook .&lt;/span&gt;</textarea>
  </div>
  <div class="crayon-main">
   <table class="crayon-table">
    <tr class="crayon-row">
     <td class="crayon-nums " data-settings="show">
      <div class="crayon-nums-content" style="font-size: 16px !important; line-height: 25px !important;">
       <div class="crayon-num" data-line="crayon-5c41e4cd2bf18149174412-1">
        1
       </div>
      </div>
     </td>
     <td class="crayon-code">
      <div class="crayon-pre" style="font-size: 16px !important; line-height: 25px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
       <div class="crayon-line" id="crayon-5c41e4cd2bf18149174412-1">
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-e">
         span
        </span>
        <span class="crayon-v">
         style
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-s">
         "font-weight: 400"
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-o">
         &amp;
        </span>
        <span class="crayon-v">
         gt
        </span>
        <span class="crayon-sy">
         ;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         span
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-e">
         span
        </span>
        <span class="crayon-v">
         style
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-s">
         "font-weight: 400"
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-e">
         docker
        </span>
        <span class="crayon-v">
         build
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         -
        </span>
        <span class="crayon-i">
         t
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-i">
         geonotebook
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         span
        </span>
        <span class="crayon-o">
         &gt;
        </span>
       </div>
      </div>
     </td>
    </tr>
   </table>
  </div>
 </div>
 <!-- [Format Time: 0.0002 seconds] -->
 <p>
  And run the notebook:
 </p>
 <!-- Crayon Syntax Highlighter v_2.7.2_beta -->
 <div class="crayon-syntax crayon-theme-coy crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c41e4cd2bf1a061096822" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 25px !important;">
  <div class="crayon-plain-wrap">
   <textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 25px !important;" wrap="soft">
&lt;span style="font-weight: 400"&gt;&amp;gt; &lt;/span&gt;&lt;span style="font-weight: 400"&gt;docker run -p 8888:8888 -v /path/to/your/notebooks:/notebooks  -it --rm geonotebook&lt;/span&gt;</textarea>
  </div>
  <div class="crayon-main">
   <table class="crayon-table">
    <tr class="crayon-row">
     <td class="crayon-nums " data-settings="show">
      <div class="crayon-nums-content" style="font-size: 16px !important; line-height: 25px !important;">
       <div class="crayon-num" data-line="crayon-5c41e4cd2bf1a061096822-1">
        1
       </div>
      </div>
     </td>
     <td class="crayon-code">
      <div class="crayon-pre" style="font-size: 16px !important; line-height: 25px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
       <div class="crayon-line" id="crayon-5c41e4cd2bf1a061096822-1">
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-e">
         span
        </span>
        <span class="crayon-v">
         style
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-s">
         "font-weight: 400"
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-o">
         &amp;
        </span>
        <span class="crayon-v">
         gt
        </span>
        <span class="crayon-sy">
         ;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         span
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-e">
         span
        </span>
        <span class="crayon-v">
         style
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-s">
         "font-weight: 400"
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-e">
         docker
        </span>
        <span class="crayon-v">
         run
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         -
        </span>
        <span class="crayon-i">
         p
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-cn">
         8888
        </span>
        <span class="crayon-o">
         :
        </span>
        <span class="crayon-cn">
         8888
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         -
        </span>
        <span class="crayon-v">
         v
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         path
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-st">
         to
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         your
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         notebooks
        </span>
        <span class="crayon-o">
         :
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-i">
         notebooks
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         -
        </span>
        <span class="crayon-v">
         it
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         --
        </span>
        <span class="crayon-e">
         rm
        </span>
        <span class="crayon-v">
         geonotebook
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         span
        </span>
        <span class="crayon-o">
         &gt;
        </span>
       </div>
      </div>
     </td>
    </tr>
   </table>
  </div>
 </div>
 <!-- [Format Time: 0.0003 seconds] -->
 <p>
  <span style="font-weight: 400">
   GeoNotebook expands upon the basic Jupyter Notebook architecture of Notebook Cells, Tornado Webserver, and python kernel by adding a GeoNotebook Kernel, a Jupyter server extension for tile rendering and an interactive client-side map.  That means once it is installed, you can dive in using data from your own computer.
  </span>
 </p>
 <h2>
  <span style="font-weight: 400">
   GeoNotebook Architecture
  </span>
 </h2>
 <p style="text-align: center">
  <img alt="" class="alignnone size-large wp-image-18022 aligncenter" height="720" sizes="(max-width: 960px) 100vw, 960px" src="https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack.png 960w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack-300x225.png 300w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack-768x576.png 768w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack-220x165.png 220w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack-250x188.png 250w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack-355x266.png 355w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack-730x548.png 730w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook2-KTileStack-90x68.png 90w" width="960"/>
  <br/>
  <em>
   GeoNotebook Architecture Diagram
  </em>
 </p>
 <p>
  <span style="font-weight: 400">
   On the client side, a GeoJS map joins the notebook cells in the browser, displaying the GIS data side by side with the Notebook cells.  The GeoNotebook kernel injects a custom object into the python execution environment that provides a Python API for interacting with the map (e.g. adding and removing layers). Additionally, because the GeoJS map can talk back to the GeoNotebook Kernel, you can also interact with the map and have it affect the python (e.g. subsetting data with map annotations).  For example, if you manually annotate an area on the map, that annotation will be reflected in the Notebook cells.
  </span>
 </p>
 <p>
  <img alt="" class="size-large wp-image-18021 aligncenter" height="576" sizes="(max-width: 1024px) 100vw, 1024px" src="https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-1024x576.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-1024x576.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-300x169.png 300w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-768x432.png 768w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-220x124.png 220w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-250x141.png 250w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-355x200.png 355w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-730x411.png 730w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations-90x51.png 90w, https://blog.kitware.com/wp-content/uploads/2017/05/Geonotebook02-Annotations.png 1600w" width="1024"/>
 </p>
 <p>
  <span style="font-weight: 400">
   This two-way communication works via a set of custom remote procedure calls, managed by the Comm channel. The Comm channel abstraction is key to a whole bunch of exciting new functionality.
  </span>
 </p>
 <p>
  <span style="font-weight: 400">
   For more details, check out the
  </span>
  <a href="http://geonotebook.readthedocs.io/en/latest/">
   <span style="font-weight: 400">
    GeoNotebook readthedocs
   </span>
  </a>
  <span style="font-weight: 400">
   , or email us at
  </span>
  <a href="mailto:kitware@kitware.com">
   <span style="font-weight: 400">
    kitware@kitware.com
   </span>
  </a>
  <span style="font-weight: 400">
   to learn more about using GeoNotebook for your geospatial data.
  </span>
 </p>
 <p>
  <span style="font-weight: 400">
   Chris Kotfila will be presenting GeoNotebook at the upcoming
  </span>
  <a href="https://conferences.oreilly.com/jupyter/jup-ny">
   <span style="font-weight: 400">
    JupyterCon
   </span>
  </a>
  <span style="font-weight: 400">
   and
  </span>
  <a href="http://2017.foss4g.org/">
   <span style="font-weight: 400">
    FOSS4G
   </span>
  </a>
  <span style="font-weight: 400">
   conferences.  Both will put videos online after the conference, so keep an eye out for those tutorials soon!
  </span>
 </p>
 <p>
 </p>
 <div>
  <p>
   <b>
    Acknowledgement
   </b>
  </p>
 </div>
 <div>
  We are thankful to Dr. Ramakrishna Nemani, Senior Earth Scientist at NASA Ames Research Center, for providing guidance and science use-cases, and NASA Headquarters for providing this opportunity.
 </div>
</div>
