<meta charset="utf-8">
<div class="entry-content">
 <p>
  In scientific visualization, gradient computations vary based on the use case. For use cases with shallow water simulations or free surface simulations, cells of different dimensions should contribute to the computations in some manner. For other use cases, cells of different dimensions should not contribute to the computations.
 </p>
 <p>
  ParaView, a very general tool for analyzing and visualizing data, can compute gradients. This article examines two use cases of ParaView. Both use cases rely on the Calculator filter to generate a Point Data field from input. The use cases then apply the GradientOfUnstructuredDataSet filter to compute results.
 </p>
 <div class="wp-caption aligncenter" id="attachment_23317" style="width: 287px">
  <img alt="" class="wp-image-23317 size-full" height="300" sizes="(max-width: 277px) 100vw, 277px" src="http://blog.kitware.com/wp-content/uploads/2018/08/cubeGRID.png" srcset="https://blog.kitware.com/wp-content/uploads/2018/08/cubeGRID.png 277w, https://blog.kitware.com/wp-content/uploads/2018/08/cubeGRID-220x238.png 220w, https://blog.kitware.com/wp-content/uploads/2018/08/cubeGRID-250x271.png 250w, https://blog.kitware.com/wp-content/uploads/2018/08/cubeGRID-90x97.png 90w" width="277"/>
  <p class="wp-caption-text">
   Two-dimensional cells are outlined in purple.
  </p>
 </div>
 <h2>
  Use Case 1
 </h2>
 <p>
  The first use case employs a dataset that has both two-dimensional (2D) and three-dimensional (3D) cells, where the 2D cells serve as the faces of a subset of the 3D cells.
 </p>
 <p>
  ParaView generates a Point Data field from the dataset, using the Calculator filter and the following input: coordsX+coordsY+coordsZ. When the GradientOfUnstructuredDataSet filter is applied to the Point Data field, the expected result is a tuple of [1, 1, 1] throughout the dataset. Since 2D cells incorrectly contribute to the computation, however, the gradient is wrong where 2D cells are present.
 </p>
 <div class="wp-caption aligncenter" id="attachment_23317" style="width: 287px">
  <img alt="" class="wp-image-23317 size-full" height="300" src="http://blog.kitware.com/wp-content/uploads/2018/08/cubeRED.png" width="277"/>
  <p class="wp-caption-text">
   GradientOfUnstructuredDataSet produces an unexpected result.
  </p>
 </div>
 <p>
  A new feature of GradientOfUnstructuredDataSet produces the expected result. This feature, called ContributingCellOption, helps to control what cells contribute to the computation. Note that this is an advanced feature; by default, it will not be visible in the GradientOfUnstructuredDataSet options in the graphical user interface of ParaView.
 </p>
 <div class="wp-caption aligncenter" id="attachment_23317" style="width: 287px">
  <img alt="" class="wp-image-23317 size-full" height="300" src="http://blog.kitware.com/wp-content/uploads/2018/08/cubeBLUE.png" width="277"/>
  <p class="wp-caption-text">
   DataSetMax produces the expected result.
  </p>
 </div>
 <p>
  There are three enumerations for ContributingCellOption: DataSetMax, All and Patch. The default, DataSetMax, only uses cells with the highest dimension in a dataset to compute gradient quantities. Unlike DataSetMax, All uses each cell in the dataset to compute gradient quantities. This option provides the behavior for ParaView 5.4 and earlier. Alternatively, Patch only considers cells that contribute to the local gradient computation. From these cells, Patch selects those with the highest dimension.
 </p>
 <h1>
  Use Case 2
 </h1>
 <p>
  Another use case employs a dataset in which 3D cells are present in one part of the domain, and 2D cells are present in another part. To be clear, these parts are connected.
 </p>
 <p class="">
  For this use case, coordsX*coordsX+coordsY*coordsY+coordsZ*coordsZ serves as the input to the Calculator filter. While the Points Data field that the filter generates is slightly more interesting than the one in the previous example, a numerical result from this use case can still be compared to an analytical result. Here are the results for the X-component, the Y-component and the Z-component of the gradient.
 </p>
 <p>
  <img alt="" class="aligncenter size-full wp-image-23400" height="750" sizes="(max-width: 750px) 100vw, 750px" src="http://blog.kitware.com/wp-content/uploads/2018/08/ComputingUseCase_fig.png" srcset="https://blog.kitware.com/wp-content/uploads/2018/08/ComputingUseCase_fig.png 750w, https://blog.kitware.com/wp-content/uploads/2018/08/ComputingUseCase_fig-300x300.png 300w, https://blog.kitware.com/wp-content/uploads/2018/08/ComputingUseCase_fig-220x220.png 220w, https://blog.kitware.com/wp-content/uploads/2018/08/ComputingUseCase_fig-250x250.png 250w, https://blog.kitware.com/wp-content/uploads/2018/08/ComputingUseCase_fig-355x355.png 355w, https://blog.kitware.com/wp-content/uploads/2018/08/ComputingUseCase_fig-730x730.png 730w, https://blog.kitware.com/wp-content/uploads/2018/08/ComputingUseCase_fig-90x90.png 90w" width="750"/>
 </p>
 <div class="wp-caption alignright" id="attachment_23322" style="width: 360px">
  <img alt="" class="wp-image-23322" height="371" sizes="(max-width: 350px) 100vw, 350px" src="http://blog.kitware.com/wp-content/uploads/2018/08/error_all-967x1024.jpg" srcset="https://blog.kitware.com/wp-content/uploads/2018/08/error_all-967x1024.jpg 967w, https://blog.kitware.com/wp-content/uploads/2018/08/error_all-283x300.jpg 283w, https://blog.kitware.com/wp-content/uploads/2018/08/error_all-768x813.jpg 768w, https://blog.kitware.com/wp-content/uploads/2018/08/error_all-220x233.jpg 220w, https://blog.kitware.com/wp-content/uploads/2018/08/error_all-250x265.jpg 250w, https://blog.kitware.com/wp-content/uploads/2018/08/error_all-355x376.jpg 355w, https://blog.kitware.com/wp-content/uploads/2018/08/error_all-730x773.jpg 730w, https://blog.kitware.com/wp-content/uploads/2018/08/error_all-90x95.jpg 90w, https://blog.kitware.com/wp-content/uploads/2018/08/error_all.jpg 1020w" width="350"/>
  <p class="wp-caption-text">
   A close-up of the All option reveals an error.
  </p>
 </div>
 <div class="wp-caption alignright" id="attachment_23323" style="width: 360px">
  <img alt="" class="wp-image-23323" height="371" sizes="(max-width: 350px) 100vw, 350px" src="http://blog.kitware.com/wp-content/uploads/2018/08/error_patch.jpg" srcset="https://blog.kitware.com/wp-content/uploads/2018/08/error_patch.jpg 1020w, https://blog.kitware.com/wp-content/uploads/2018/08/error_patch-283x300.jpg 283w, https://blog.kitware.com/wp-content/uploads/2018/08/error_patch-768x813.jpg 768w, https://blog.kitware.com/wp-content/uploads/2018/08/error_patch-967x1024.jpg 967w, https://blog.kitware.com/wp-content/uploads/2018/08/error_patch-220x233.jpg 220w, https://blog.kitware.com/wp-content/uploads/2018/08/error_patch-250x265.jpg 250w, https://blog.kitware.com/wp-content/uploads/2018/08/error_patch-355x376.jpg 355w, https://blog.kitware.com/wp-content/uploads/2018/08/error_patch-730x773.jpg 730w, https://blog.kitware.com/wp-content/uploads/2018/08/error_patch-90x95.jpg 90w" width="350"/>
  <p class="wp-caption-text">
   A close-up of the Patch option reveals a properly computed gradient.
  </p>
 </div>
 <p class="">
  The results of DataSetMax are likely not desired in this case, as the filter produces Not-a-Number (NaN) values over the 2D cells. This is shown by the yellow pseudocoloring in the above images. While All and Patch give the expected results for the X-component and the Z-component, the results for the Y-component call for further analysis. This analysis can be performed by comparing the numerical result of the Y-component for each computation with the analytical result of 2*coordsY. The Calculator filter can make this comparison using the abs(Gradients_Y-2*coordsY) expression, if “Error” is designated in the field for Result Array Name.
 </p>
 <p>
  The images on the right show the results of All and Patch pseudocolored by “Error.” In the top image, All produces an error in 3D cells that use the same points as 2D cells. Patch does not produce this error, as the bottom image demonstrates. This result is expected, as Patch ignores contributions from 2D cells for points that are connected to 3D cells.
 </p>
 <p>
  In addition, both All and Patch produce an error in 2D cells. Since 2D cells are located in the XZ-plane, there is no depth in the Y-direction. Therefore, there is no variation in the Y-direction, and the computed Y-component of the gradient is zero.
 </p>
 <p>
  In light of the fact that this use case does not have valid values for all gradient quantities, another new feature of GradientOfUnstructuredDataSet comes into play. This feature is called ReplacementValueOption. Like ContributingCellOption, ReplacementValueOption is an advanced feature. Its enumerations are NaN, which is the default; Zero; DataTypeMin; and DataTypeMax. For this use case, the results for NaN should trigger the realization that something is amiss with the ContributingCellOption results. A possible solution is to threshold out the cells with NaN values.
 </p>
 <h1>
  Acknowledgment
 </h1>
 <p>
  The datasets for both use cases are available at
  <a href="https://data.kitware.com/#folder/5a1c85008d777f7ddd99ab8b" rel="noopener" target="_blank">
   https://data.kitware.com/#folder/5a1c85008d777f7ddd99ab8b
  </a>
  . While this article explores the datasets in ParaView, the new features of GradientOfUnstructuredDataSet come from vtkGradientFilter in the Visualization Toolkit (VTK). For backwards compatibility, the default behavior for vtkGradientFilter uses the All option in ContributingCellOption.
 </p>
 <p>
  The work in VTK and ParaView was funded by Sandia National Laboratories. In particular, Ken Moreland from Sandia took part in discussions on how to improve gradient computation with VTK and ParaView for a variety of use cases.
 </p>
 <p>
  Sandia National Laboratories is a multimission laboratory managed and operated by National Technology and Engineering Solutions of Sandia, LLC., a wholly owned subsidiary of Honeywell International, Inc., for the U.S. Department of Energy’s National Nuclear Security Administration under contract DE-NA0003525.
 </p>
 <p>
  <strong>
   <img alt="" class="alignleft wp-image-16237" height="125" src="http://blog.kitware.com/wp-content/uploads/2016/10/Andy-Bauer-Headshot.bmp" width="100"/>
   Andrew Bauer
  </strong>
  is a staff R&amp;D engineer on the high-performance computing (HPC) and visualization team at Kitware. He primarily works on enabling tools and technologies for HPC simulations.
 </p>
 <a class="btn-sourcepdf" href="https://blog.kitware.com/wp-content/uploads/2018/09/Source_Issue_43.pdf" target="_blank">
  Source Issue
 </a>
</div>
