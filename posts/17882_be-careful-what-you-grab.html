<meta charset="utf-8">
<div class="entry-content">
 <p>
  Grabbing a rendered image is a fairly common thing to do in VTK applications. Many do that as follows:
 </p>
 <!-- Crayon Syntax Highlighter v_2.7.2_beta -->
 <div class="crayon-syntax crayon-theme-coy crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c41e86223101237634543" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 25px !important;">
  <div class="crayon-plain-wrap">
   <textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 25px !important;" wrap="soft">
vtkRenderWindow *renWin = ...
..
renWin-&gt;Render()

vtkNew&lt;vtkWindowToImage&gt; w2i;
..
// Let's grab from back buffer as that overcomes
// issues with overlapping windows or other UI
// components obfuscating the captured image on
// certain windowing systems/platforms.
w2i-&gt;ReadFrontBufferOff();
w2i-&gt;Update();</textarea>
  </div>
  <div class="crayon-main">
   <table class="crayon-table">
    <tr class="crayon-row">
     <td class="crayon-nums " data-settings="show">
      <div class="crayon-nums-content" style="font-size: 16px !important; line-height: 25px !important;">
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-1">
        1
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-2">
        2
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-3">
        3
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-4">
        4
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-5">
        5
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-6">
        6
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-7">
        7
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-8">
        8
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-9">
        9
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-10">
        10
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-11">
        11
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223101237634543-12">
        12
       </div>
      </div>
     </td>
     <td class="crayon-code">
      <div class="crayon-pre" style="font-size: 16px !important; line-height: 25px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
       <div class="crayon-line" id="crayon-5c41e86223101237634543-1">
        <span class="crayon-v">
         vtkRenderWindow
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-v">
         renWin
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-sy">
         .
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-2">
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-sy">
         .
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-3">
        <span class="crayon-v">
         renWin
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         Render
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-4">
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-5">
        <span class="crayon-v">
         vtkNew
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-v">
         vtkWindowToImage
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         w2i
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-6">
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-sy">
         .
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-7">
        <span class="crayon-c">
         // Let's grab from back buffer as that overcomes
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-8">
        <span class="crayon-c">
         // issues with overlapping windows or other UI
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-9">
        <span class="crayon-c">
         // components obfuscating the captured image on
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-10">
        <span class="crayon-c">
         // certain windowing systems/platforms.
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-11">
        <span class="crayon-v">
         w2i
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         ReadFrontBufferOff
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223101237634543-12">
        <span class="crayon-v">
         w2i
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         Update
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
      </div>
     </td>
    </tr>
   </table>
  </div>
 </div>
 <!-- [Format Time: 0.0003 seconds] -->
 <p>
  This seemingly innocuous code has a serious flaw. You’re actually grabbing
  <em>
   <strong>
    undefined
   </strong>
  </em>
  contents! Let’s look at what’s going on a little more closely.
 </p>
 <p>
  <a href="http://www.vtk.org/doc/nightly/html/classvtkRenderWindow.html">
   <strong>
    vtkRenderWindow
   </strong>
  </a>
  , by default, is setup to use
  <a href="http://www.vtk.org/doc/nightly/html/classvtkWindow.html#a83380fc6577e11a473846164df02831f">
   double-buffering
  </a>
  . When using double-buffering, it is also setup to
  <a href="http://www.vtk.org/doc/nightly/html/classvtkRenderWindow.html#a9713c85594301a17671d5e8be532cac9">
   swap back and front buffers
  </a>
  at the
  <a href="http://www.vtk.org/doc/nightly/html/classvtkRenderWindow.html#a8b5f4f9ddec6a555359e5189bb629548">
   end of each render
  </a>
  . The kicker is that despite its name (and common perception), this swap is not defined as a true swap. It merely implies back buffer contents being copied to the front buffer. What is left in the back buffer at the end of the swap is
  <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl2.1/xhtml/glXSwapBuffers.xml">
   not defined
  </a>
  . As a result, when
  <a href="http://www.vtk.org/doc/nightly/html/classvtkWindowToImageFilter.html">
   <strong>
    vtkWindowToImage
   </strong>
  </a>
  filter goes to grab the back-buffer after the render, it invariable is reading undefined contents — although one may be getting lucky in most cases.
 </p>
 <p>
  The correct way to address this would be as follows:
 </p>
 <!-- Crayon Syntax Highlighter v_2.7.2_beta -->
 <div class="crayon-syntax crayon-theme-coy crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c41e86223109723401705" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 25px !important;">
  <div class="crayon-plain-wrap">
   <textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 25px !important;" wrap="soft">
vtkRenderWindow *renWin = ...
..
renWin-&gt;Render()

vtkNew&lt;vtkWindowToImage&gt; w2i;
..

int oldSB = renWin-&gt;GetSwapBuffers();
// Tell render window to not swap buffers at end of render.
&lt;strong&gt;renWin-&gt;SwapBuffersOff();
&lt;/strong&gt;
w2i-&gt;ReadFrontBufferOff();
w2i-&gt;Update();

// restore swapping state
renWin-&gt;SetSwapBuffers(oldSB);</textarea>
  </div>
  <div class="crayon-main">
   <table class="crayon-table">
    <tr class="crayon-row">
     <td class="crayon-nums " data-settings="show">
      <div class="crayon-nums-content" style="font-size: 16px !important; line-height: 25px !important;">
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-1">
        1
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-2">
        2
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-3">
        3
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-4">
        4
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-5">
        5
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-6">
        6
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-7">
        7
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-8">
        8
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-9">
        9
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-10">
        10
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-11">
        11
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-12">
        12
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-13">
        13
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-14">
        14
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-15">
        15
       </div>
       <div class="crayon-num" data-line="crayon-5c41e86223109723401705-16">
        16
       </div>
      </div>
     </td>
     <td class="crayon-code">
      <div class="crayon-pre" style="font-size: 16px !important; line-height: 25px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
       <div class="crayon-line" id="crayon-5c41e86223109723401705-1">
        <span class="crayon-v">
         vtkRenderWindow
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         *
        </span>
        <span class="crayon-v">
         renWin
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-sy">
         .
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-2">
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-sy">
         .
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-3">
        <span class="crayon-v">
         renWin
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         Render
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-4">
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-5">
        <span class="crayon-v">
         vtkNew
        </span>
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-v">
         vtkWindowToImage
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         w2i
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-6">
        <span class="crayon-sy">
         .
        </span>
        <span class="crayon-sy">
         .
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-7">
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-8">
        <span class="crayon-t">
         int
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         oldSB
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-o">
         =
        </span>
        <span class="crayon-h">
        </span>
        <span class="crayon-v">
         renWin
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         GetSwapBuffers
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-9">
        <span class="crayon-c">
         // Tell render window to not swap buffers at end of render.
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-10">
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-v">
         strong
        </span>
        <span class="crayon-o">
         &gt;
        </span>
        <span class="crayon-v">
         renWin
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         SwapBuffersOff
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-11">
        <span class="crayon-o">
         &lt;
        </span>
        <span class="crayon-o">
         /
        </span>
        <span class="crayon-v">
         strong
        </span>
        <span class="crayon-o">
         &gt;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-12">
        <span class="crayon-v">
         w2i
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         ReadFrontBufferOff
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-13">
        <span class="crayon-v">
         w2i
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         Update
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-14">
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-15">
        <span class="crayon-c">
         // restore swapping state
        </span>
       </div>
       <div class="crayon-line" id="crayon-5c41e86223109723401705-16">
        <span class="crayon-v">
         renWin
        </span>
        <span class="crayon-o">
         -&gt;
        </span>
        <span class="crayon-e">
         SetSwapBuffers
        </span>
        <span class="crayon-sy">
         (
        </span>
        <span class="crayon-v">
         oldSB
        </span>
        <span class="crayon-sy">
         )
        </span>
        <span class="crayon-sy">
         ;
        </span>
       </div>
      </div>
     </td>
    </tr>
   </table>
  </div>
 </div>
 <!-- [Format Time: 0.0004 seconds] -->
 <p>
  Another thing to note is that if you are telling
  <a href="http://www.vtk.org/doc/nightly/html/classvtkWindowToImageFilter.html">
   <strong>
    vtkWindowToImage
   </strong>
  </a>
  filter to not re-render i.e.
  <strong>
   <a href="http://www.vtk.org/doc/nightly/html/classvtkWindowToImageFilter.html#a2b64e788b28c031edc761f67f2524206">
    vtkWindowToImage::ShouldRerenderOff
   </a>
   ()
  </strong>
  , then make sure that the
  <strong>
   SwapBuffers
  </strong>
  is turned off before the latest
  <strong>
   Render
  </strong>
  call on the render-window.
 </p>
</div>
