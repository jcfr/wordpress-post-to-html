<meta charset="utf-8">
<div class="entry-content">
 <div id="main-container">
  <p>
   <a href="https://www.vtk.org/">
    The Visualization Toolkit (VTK)
   </a>
   is an open source, freely available software system for 3D computer graphics, image processing and visualization. VTK consists of a wide variety of visualization algorithms including advanced modeling techniques such as implicit modeling, polygon reduction, mesh smoothing, cutting, contouring and Delaunay triangulation. Through collaboration with various government and industry partners, Kitware continues to maintain and enhance VTK’s capabilities. This report details a useful addition to the Visualization Toolkit brought about by a unique requirement of climate data visualization.
  </p>
  <p>
   <a href="https://uvcdat.llnl.gov">
    UV-CDAT (Ultrascale Climate Data Analysis and Visualization)
   </a>
   is a framework developed at the
   <a href="https://www.llnl.gov/">
    Lawrence Livermore National Laboratory (LLNL)
   </a>
   for analysis, visualization and management of large scale distributed climate data. The visualization component system (VCS) of UV-CDAT uses VTK as the data processing and visualization backend. UV-CDAT is used by climate scientists to visualize different parameters of massive climate datasets using different techniques like contour, heatmap, vector, and streamline plots along with volumetric display.
  </p>
  <style type="text/css">
   #gallery-2{margin:auto}#gallery-2 .gallery-item{float:left;margin-top:10px;text-align:center;width:33%}#gallery-2 img{border:2px solid #cfcfcf}#gallery-2 .gallery-caption{margin-left:0}
  </style>
  <div class="gallery galleryid-17833 gallery-columns-3 gallery-size-full" id="gallery-2">
   <dl class="gallery-item">
    <dt class="gallery-icon landscape">
     <a href="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig.png">
      <img alt="" aria-describedby="gallery-2-17852" class="attachment-full size-full" height="1090" sizes="(max-width: 1200px) 100vw, 1200px" src="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig.png 1200w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig-300x273.png 300w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig-768x698.png 768w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig-1024x930.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig-220x200.png 220w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig-250x227.png 250w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig-355x322.png 355w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig-730x663.png 730w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_solid_SH_-180_180_non-contig-90x82.png 90w" width="1200"/>
     </a>
    </dt>
    <dd class="wp-caption-text gallery-caption" id="gallery-2-17852">
     Solid isofill plot for surface air temperature using CDAT
    </dd>
   </dl>
   <dl class="gallery-item">
    <dt class="gallery-icon landscape">
     <a href="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig.png">
      <img alt="" aria-describedby="gallery-2-17851" class="attachment-full size-full" height="1090" sizes="(max-width: 1200px) 100vw, 1200px" src="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig.png 1200w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig-300x273.png 300w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig-768x698.png 768w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig-1024x930.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig-220x200.png 220w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig-250x227.png 250w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig-355x322.png 355w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig-730x663.png 730w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_pattern_SH_-180_180_non-contig-90x82.png 90w" width="1200"/>
     </a>
    </dt>
    <dd class="wp-caption-text gallery-caption" id="gallery-2-17851">
     Patterned isofill plot for surface air temperature using CDAT
    </dd>
   </dl>
   <dl class="gallery-item">
    <dt class="gallery-icon landscape">
     <a href="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig.png">
      <img alt="" aria-describedby="gallery-2-17850" class="attachment-full size-full" height="1090" sizes="(max-width: 1200px) 100vw, 1200px" src="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig.png 1200w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig-300x273.png 300w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig-768x698.png 768w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig-1024x930.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig-220x200.png 220w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig-250x227.png 250w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig-355x322.png 355w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig-730x663.png 730w, https://blog.kitware.com/wp-content/uploads/2017/04/test_vcs_isofill_hatch_SH_-180_180_non-contig-90x82.png 90w" width="1200"/>
     </a>
    </dt>
    <dd class="wp-caption-text gallery-caption" id="gallery-2-17850">
     Hatched isofill plot for surface air temperature using CDAT
    </dd>
   </dl>
   <br style="clear: both"/>
  </div>
 </div>
 <div id="main-container">
  <p>
   An important element of climate data plots involves delineating different regions of the dataset using colors, patterns and hatches. A pattern in UV-CDAT is a regular black shape repeated over the expanse of the surface, while a hatch is colored pattern. VTK supports mapping point and cell scalar values to colors using lookup tables. However, filling regions with patterns / hatches required an additional data processing pipeline:
  </p>
  <div class="wp-caption aligncenter" id="attachment_17864" style="width: 310px">
   <a href="https://blog.kitware.com/wp-content/uploads/2017/04/Region.png">
    <img class="wp-image-17864 size-medium" height="199" sizes="(max-width: 300px) 100vw, 300px" src="https://blog.kitware.com/wp-content/uploads/2017/04/Region-300x199.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/04/Region-300x199.png 300w, https://blog.kitware.com/wp-content/uploads/2017/04/Region-235x156.png 235w, https://blog.kitware.com/wp-content/uploads/2017/04/Region-768x510.png 768w, https://blog.kitware.com/wp-content/uploads/2017/04/Region-1024x681.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/04/Region-220x146.png 220w, https://blog.kitware.com/wp-content/uploads/2017/04/Region-250x166.png 250w, https://blog.kitware.com/wp-content/uploads/2017/04/Region-355x236.png 355w, https://blog.kitware.com/wp-content/uploads/2017/04/Region-730x485.png 730w, https://blog.kitware.com/wp-content/uploads/2017/04/Region-90x60.png 90w" width="300"/>
   </a>
   <p class="wp-caption-text">
    Original surface to be patterned
   </p>
  </div>
  <p style="padding-left: 30px">
   1. A plane surface with glyphs matching the expected pattern is created.
  </p>
  <div class="wp-caption aligncenter" id="attachment_17862" style="width: 310px">
   <a href="https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed.png">
    <img class="wp-image-17862 size-medium" height="199" sizes="(max-width: 300px) 100vw, 300px" src="https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-300x199.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-300x199.png 300w, https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-235x156.png 235w, https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-768x510.png 768w, https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-1024x681.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-220x146.png 220w, https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-250x166.png 250w, https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-355x236.png 355w, https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-730x485.png 730w, https://blog.kitware.com/wp-content/uploads/2017/04/Glyphed-90x60.png 90w" width="300"/>
   </a>
   <p class="wp-caption-text">
    Glyphed planar surface representing pattern shapes
   </p>
  </div>
  <p style="padding-left: 30px">
   2. The plane is then cut to shape using the data region as a stencil.
  </p>
  <div class="wp-caption aligncenter" id="attachment_17861" style="width: 310px">
   <a href="https://blog.kitware.com/wp-content/uploads/2017/04/Cutter.png">
    <img class="wp-image-17861 size-medium" height="199" sizes="(max-width: 300px) 100vw, 300px" src="https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-300x199.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-300x199.png 300w, https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-235x156.png 235w, https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-768x510.png 768w, https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-1024x681.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-220x146.png 220w, https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-250x166.png 250w, https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-355x236.png 355w, https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-730x485.png 730w, https://blog.kitware.com/wp-content/uploads/2017/04/Cutter-90x60.png 90w" width="300"/>
   </a>
   <p class="wp-caption-text">
    Output of vtkCookieCutter
   </p>
  </div>
  <p style="padding-left: 30px">
   3. The cut plane is then rendered as an overlay over the dataset
  </p>
  <div class="wp-caption aligncenter" id="attachment_17863" style="width: 310px">
   <a href="https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter.png">
    <img class="wp-image-17863 size-medium" height="199" sizes="(max-width: 300px) 100vw, 300px" src="https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-300x199.png" srcset="https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-300x199.png 300w, https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-235x156.png 235w, https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-768x510.png 768w, https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-1024x681.png 1024w, https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-220x146.png 220w, https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-250x166.png 250w, https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-355x236.png 355w, https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-730x485.png 730w, https://blog.kitware.com/wp-content/uploads/2017/04/OverlayedCutter-90x60.png 90w" width="300"/>
   </a>
   <p class="wp-caption-text">
    Resultant overlay of patterned polydata
   </p>
  </div>
  <p>
   The second step in the above pipeline turned out to be a difficult step where in accurate cutting of lines, triangles and polygons is required to ensure the patterned surface fits within the data region. While VTK consists of many different ways of clipping
   <i>
    vtkPolyData
   </i>
   , including
  </p>
  <ol>
   <li style="list-style-type: none">
    <ol>
     <li style="list-style-type: none">
      <ul>
       <li>
        <i>
         vtkBooleanOperationPolyDataFilter
        </i>
        extracts intersection of two different surfaces but requires the surfaces to be distinct in bounds. Stenciling out triangulated geometry is not supported.
       </li>
       <li>
        <i>
         vtkClipDataSet
        </i>
        in combination with
        <i>
         vtkImplicitDataSet
        </i>
        could be used to clip the patterned surface with an implicit function derived from the region surface. However, this is an approximation technique and the result is not ensured to accurately fit within the boundaries of the region dataset.
       </li>
      </ul>
     </li>
    </ol>
   </li>
  </ol>
  <h2>
   vtkCookieCutter
  </h2>
  <p>
   To provide satisfactory results, we decided to implement a specialized class to perform the  cutting operation described previously. The filter crops polygonal data (vertices, lines and polylines, polygons, and triangle strips) positioned in a 2D plane with one or more loops. Both the loop and polygonal data can be non-convex. Note however that the loops are presumed not to contain internal holes.
  </p>
  <p>
   Like many geometric processing algorithms, often the basic concepts are simple while the implementation requires significant head scratching to get right. For example, numerical situations such as degeneracies can confuse a naive algorithm, and it’s also important to note the that the intersection between two concave polygons may produce multiple polygons on output. In the algorithm we implemented, we found that operations performed in the parametric space were much more reliable, as processes involving sorting, merging, and traversing output loops (i.e. polygons) are greatly simplified by sorting intersection points around the perimeter of the cutting loop (and polygonal primitives). Also in/out tests are critical to the final result, fortunately VTK already had a decent implementation and we were able to leverage that capability.
  </p>
  <p>
   A significant challenge to the algorithm is obvious from the earlier image showing the complex surface to be patterned. Note that the surface contains several interior holes, something which our algorithm does not support. However, the patterned surfaces are actually made up of simpler primitives such as triangles. Thus our solution was to treat each primitive making up the patterned surface as a separate loop which in turn was used to process the entire glyph field. At the conclusion of processing the result was that the glyphs were often cut into many pieces, but when assembled (i.e., rendered together) appeared to be whole.
  </p>
  <p>
   Performance on our data was acceptable using some geometric shortcuts like bounding box tests to accelerate computation. Note however that the algorithm could be easily sped up/threaded, including accelerating in/out tests and employing parallel glyph processing. We are hoping that the right customer or open source contributor will take this on.
  </p>
  <p>
   We would like thank the Lawrence Livermore National Laboratory and the UV-CDAT lead Dean Williams and Charles Doutriaux for sponsoring this work.
  </p>
 </div>
</div>
